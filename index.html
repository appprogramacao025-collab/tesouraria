<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grupo de Oração Nossa Senhora das Graças - Controle Financeiro</title>
    <meta name="description" content="Sistema de controle financeiro para o Grupo de Oração Nossa Senhora das Graças">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* (Seu CSS completo aqui) */
        /* ... */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(180deg, hsl(0 0% 98%), hsl(0 0% 96%));
            color: hsl(0 0% 15%);
            min-height: 100vh;
        }

        .font-serif {
            font-family: 'Playfair Display', serif;
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* ... (O restante do seu CSS) ... */

        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-positive {
            background: hsl(142 76% 95%);
            color: hsl(142 76% 20%);
        }

        .status-negative {
            background: hsl(0 84% 95%);
            color: hsl(0 84% 20%);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        .modal.open {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            max-width: 400px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            padding: 20px 24px 12px;
            border-bottom: 1px solid hsl(0 0% 95%);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .modal-body {
            padding: 20px 24px;
        }

        .modal-footer {
            padding: 12px 24px 20px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .loading {
            opacity: 0.6;
            pointer-events: none;
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
            color: hsl(0 0% 45%);
        }

        .empty-icon {
            width: 48px;
            height: 48px;
            margin: 0 auto 16px;
            opacity: 0.5;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <button class="sidebar-toggle" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="sidebar-header">
                <a href="#" class="sidebar-brand" id="homeLink">
                    <i class="fas fa-church sidebar-brand-icon"></i>
                    <div class="sidebar-brand-text">
                        <div class="sidebar-brand-title font-serif">Grupo de Oração</div>
                        <div class="sidebar-brand-subtitle font-serif">N.Sra. das Graças</div>
                    </div>
                </a>
            </div>

            <nav class="sidebar-menu">
                <div class="sidebar-menu-label">Menu Principal</div>
                <ul class="sidebar-menu-list">
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" data-section="tesouraria">
                            <i class="fas fa-dollar-sign sidebar-menu-icon"></i>
                            <span class="sidebar-menu-text">TESOURARIA</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" data-section="membros">
                            <i class="fas fa-users sidebar-menu-icon"></i>
                            <span class="sidebar-menu-text">MEMBROS</span>
                        </a>
                    </li>
                    <li class="sidebar-menu-item">
                        <a href="#" class="sidebar-menu-link" data-section="contabilidade">
                            <i class="fas fa-chart-bar sidebar-menu-icon"></i>
                            <span class="sidebar-menu-text">CONTABILIDADE</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <header class="main-header">
                <div class="main-header-content">
                    <button class="mobile-sidebar-toggle" id="mobileSidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>
            </header>

            <section class="content-section active" id="home">
                <div class="text-center mb-8">
                    <i class="fas fa-church text-4xl mb-4" style="color: hsl(0 0% 15%);"></i>
                    <h1 class="text-4xl font-serif font-bold mb-4" style="color: hsl(0 0% 15%);">
                        Grupo de Oração
                    </h1>
                    <h2 class="text-2xl font-serif font-medium mb-6" style="color: hsl(0 0% 25%);">
                        Nossa Senhora das Graças
                    </h2>
                    <p class="text-lg text-muted" style="max-width: 600px; margin: 0 auto;">
                        Sistema de controle financeiro para acompanhar as contribuições, 
                        despesas e balanço geral do nosso grupo de oração.
                    </p>
                </div>

                <div class="grid grid-4 mb-8" style="max-width: 1200px; margin: 0 auto;">
                    <div class="card gradient-dark">
                        <div class="card-header">
                            <h3 class="card-subtitle" style="color: rgba(255,255,255,0.9); margin: 0;">
                                <i class="fas fa-trending-up w-4 h-4"></i> Saldo Atual
                            </h3>
                        </div>
                        <div class="card-content">
                            <div class="text-2xl font-bold" id="homeSaldoAtual">R$ 0,00</div>
                            <p style="font-size: 12px; opacity: 0.75; margin-top: 4px;">Entradas - Saídas</p>
                        </div>
                    </div>

                    <div class="card gradient-gray">
                        <div class="card-header">
                            <h3 class="card-subtitle" style="color: rgba(255,255,255,0.9); margin: 0;">
                                <i class="fas fa-users w-4 h-4"></i> Total Membros
                            </h3>
                        </div>
                        <div class="card-content">
                            <div class="text-2xl font-bold" id="homeTotalMembros">0</div>
                            <p style="font-size: 12px; opacity: 0.75; margin-top: 4px;">Membros ativos</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-subtitle text-muted" style="margin: 0;">
                                <i class="fas fa-calendar w-4 h-4"></i> Total RCC
                            </h3>
                        </div>
                        <div class="card-content">
                            <div class="text-2xl font-bold text-slate-700" id="homeTotalRcc">R$ 0,00</div>
                            <p class="text-muted" style="font-size: 12px; margin-top: 4px;">Contribuições RCC</p>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-subtitle text-muted" style="margin: 0;">
                                <i class="fas fa-piggy-bank w-4 h-4"></i> Total Caixa Extra
                            </h3>
                        </div>
                        <div class="card-content">
                            <div class="text-2xl font-bold text-slate-600" id="homeTotalCaixaExtra">R$ 0,00</div>
                            <p class="text-muted" style="font-size: 12px; margin-top: 4px;">Contribuições extras</p>
                        </div>
                    </div>
                </div>

                <div class="grid grid-2 mb-8" style="max-width: 1200px; margin: 0 auto;">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title font-serif">Sobre o Sistema</h3>
                        </div>
                        <div class="card-content">
                            <p class="text-muted mb-4">
                                Este sistema foi desenvolvido especialmente para auxiliar no controle financeiro 
                                do nosso grupo de oração, permitindo:
                            </p>
                            <ul style="list-style: none; padding: 0;">
                                <li class="flex items-center gap-2 mb-2">
                                    <div style="width: 8px; height: 8px; background: hsl(0 0% 15%); border-radius: 50%; flex-shrink: 0;"></div>
                                    <span class="text-muted">Registro de entradas e saídas na tesouraria</span>
                                </li>
                                <li class="flex items-center gap-2 mb-2">
                                    <div style="width: 8px; height: 8px; background: hsl(0 0% 15%); border-radius: 50%; flex-shrink: 0;"></div>
                                    <span class="text-muted">Controle das contribuições RCC e caixa extra dos membros</span>
                                </li>
                                <li class="flex items-center gap-2 mb-2">
                                    <div style="width: 8px; height: 8px; background: hsl(0 0% 15%); border-radius: 50%; flex-shrink: 0;"></div>
                                    <span class="text-muted">Relatórios mensais e anuais completos</span>
                                </li>
                                <li class="flex items-center gap-2">
                                    <div style="width: 8px; height: 8px; background: hsl(0 0% 15%); border-radius: 50%; flex-shrink: 0;"></div>
                                    <span class="text-muted">Acompanhamento de saldo e balanço financeiro</span>
                                </li>
                            </ul>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title font-serif">Como Usar</h3>
                        </div>
                        <div class="card-content">
                            <div class="flex items-start gap-3 mb-3">
                                <div class="w-6 h-6 gradient-dark text-center rounded-full flex items-center justify-center font-bold" style="color: white; font-size: 14px; flex-shrink: 0; margin-top: 2px;">1</div>
                                <div>
                                    <h4 class="font-medium">Tesouraria</h4>
                                    <p class="text-muted" style="font-size: 14px;">Registre todas as entradas e saídas do caixa do grupo</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3 mb-3">
                                <div class="w-6 h-6 gradient-dark text-center rounded-full flex items-center justify-center font-bold" style="color: white; font-size: 14px; flex-shrink: 0; margin-top: 2px;">2</div>
                                <div>
                                    <h4 class="font-medium">Membros</h4>
                                    <p class="text-muted" style="font-size: 14px;">Gerencie os membros e suas contribuições mensais</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <div class="w-6 h-6 gradient-dark text-center rounded-full flex items-center justify-center font-bold" style="color: white; font-size: 14px; flex-shrink: 0; margin-top: 2px;">3</div>
                                <div>
                                    <h4 class="font-medium">Contabilidade</h4>
                                    <p class="text-muted" style="font-size: 14px;">Visualize relatórios e balanços mensais e anuais</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card" style="max-width: 1200px; margin: 0 auto;">
                    <div class="card-header">
                        <h3 class="card-title font-serif">Atividades Recentes</h3>
                    </div>
                    <div class="card-content">
                        <div id="recentActivities">
                            <p class="text-center text-muted py-8">Nenhuma atividade registrada ainda</p>
                        </div>
                    </div>
                </div>
            </section>

            <section class="content-section" id="tesouraria">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-serif font-bold mb-2" style="color: hsl(0 0% 15%);">Tesouraria</h1>
                    <p class="text-muted">Controle de entradas e saídas do grupo</p>
                </div>

                <div class="grid grid-3 mb-8">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-subtitle text-muted flex items-center gap-2" style="margin: 0;">
                                <i class="fas fa-trending-up text-green-600"></i> Total Entradas
                            </h3>
                        </div>
                        <div class="card-content">
                            <div class="text-2xl font-bold text-green-600" id="totalEntradas">R$ 0,00</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-subtitle text-muted flex items-center gap-2" style="margin: 0;">
                                <i class="fas fa-trending-down text-red-600"></i> Total Saídas
                            </h3>
                        </div>
                        <div class="card-content">
                            <div class="text-2xl font-bold text-red-600" id="totalSaidas">R$ 0,00</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-subtitle text-muted" style="margin: 0;">Saldo Atual</h3>
                        </div>
                        <div class="card-content">
                            <div class="text-2xl font-bold" id="saldoAtual">R$ 0,00</div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-2">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-plus"></i> Nova Transação
                            </h3>
                        </div>
                        <div class="card-content">
                            <form class="form" id="transactionForm">
                                <div class="form-group">
                                    <label class="form-label">Tipo *</label>
                                    <select class="form-select" id="transactionType" required>
                                        <option value="entrada">Entrada</option>
                                        <option value="saida">Saída</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Descrição *</label>
                                    <textarea class="form-textarea" id="transactionDescription" placeholder="Descrição da transação" required></textarea>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Valor (R$) *</label>
                                    <input type="number" class="form-input" id="transactionAmount" step="0.01" placeholder="0,00" required>
                                </div>

                                <div class="grid grid-2">
                                    <div class="form-group">
                                        <label class="form-label">Mês</label>
                                        <select class="form-select" id="transactionMonth">
                                            <option value="1">Janeiro</option>
                                            <option value="2">Fevereiro</option>
                                            <option value="3">Março</option>
                                            <option value="4">Abril</option>
                                            <option value="5">Maio</option>
                                            <option value="6">Junho</option>
                                            <option value="7">Julho</option>
                                            <option value="8">Agosto</option>
                                            <option value="9">Setembro</option>
                                            <option value="10">Outubro</option>
                                            <option value="11">Novembro</option>
                                            <option value="12">Dezembro</option>
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label class="form-label">Ano</label>
                                        <select class="form-select" id="transactionYear"></select>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">Data</label>
                                    <input type="date" class="form-input" id="transactionDate">
                                </div>

                                <button type="submit" class="btn btn-primary btn-full">
                                    Registrar Transação
                                </button>
                            </form>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Histórico Recente</h3>
                        </div>
                        <div class="card-content">
                            <div id="transactionsList">
                                <p class="text-center text-muted py-8">Nenhuma transação registrada ainda.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <section class="content-section" id="membros">
                <div class="text-center py-20">
                    <i class="fas fa-users text-4xl mb-4" style="opacity: 0.2; color: #333;"></i>
                    <h2 class="text-2xl font-serif font-bold text-muted">Membros</h2>
                    <p class="text-muted mt-2">Página em desenvolvimento...</p>
                </div>
            </section>

            <section class="content-section" id="contabilidade">
                <div class="text-center py-20">
                    <i class="fas fa-chart-bar text-4xl mb-4" style="opacity: 0.2; color: #333;"></i>
                    <h2 class="text-2xl font-serif font-bold text-muted">Contabilidade</h2>
                    <p class="text-muted mt-2">Página em desenvolvimento...</p>
                </div>
            </section>
        </main>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyA4ojfhf2r65ch0KwtCLR4OGdesBBVl7Ok",
            authDomain: "tesouraria-17927.firebaseapp.com",
            projectId: "tesouraria-17927",
            storageBucket: "tesouraria-17927.firebasestorage.app",
            messagingSenderId: "618185390033",
            appId: "1:618185390033:web:53b6f976ca66f48edd52f0",
            measurementId: "G-NM7X5BJBN7"
        };

        // Inicialize o Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Variáveis globais para os elementos do dashboard
        const totalEntradasEl = document.getElementById('totalEntradas');
        const totalSaidasEl = document.getElementById('totalSaidas');
        const saldoAtualEl = document.getElementById('saldoAtual');
        const homeSaldoAtualEl = document.getElementById('homeSaldoAtual');

        // Referência para os cards do dashboard
        const tesourariaCards = {
            totalEntradas: document.getElementById('totalEntradas'),
            totalSaidas: document.getElementById('totalSaidas'),
            saldoAtual: document.getElementById('saldoAtual'),
        };

        const homeCards = {
            saldoAtual: document.getElementById('homeSaldoAtual'),
            totalMembros: document.getElementById('homeTotalMembros'),
            totalRcc: document.getElementById('homeTotalRcc'),
            totalCaixaExtra: document.getElementById('homeTotalCaixaExtra'),
        };

        const recentActivitiesList = document.getElementById('recentActivities');
        const transactionsList = document.getElementById('transactionsList');
        const transactionForm = document.getElementById('transactionForm');
        
        // Função para formatar o valor para moeda brasileira
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        // Função para carregar transações e atualizar o dashboard
        async function loadTransactions() {
            try {
                const snapshot = await db.collection('transacoes').orderBy('data', 'desc').get();
                let totalEntradas = 0;
                let totalSaidas = 0;
                let transactionsHtml = '';
                let recentActivitiesHtml = '';

                if (snapshot.empty) {
                    transactionsList.innerHTML = '<p class="text-center text-muted py-8">Nenhuma transação registrada ainda.</p>';
                    recentActivitiesList.innerHTML = '<p class="text-center text-muted py-8">Nenhuma atividade registrada ainda</p>';
                    totalEntradasEl.textContent = formatCurrency(0);
                    totalSaidasEl.textContent = formatCurrency(0);
                    saldoAtualEl.textContent = formatCurrency(0);
                    homeSaldoAtualEl.textContent = formatCurrency(0);
                    return;
                }
                
                let count = 0;
                snapshot.forEach(doc => {
                    const transacao = doc.data();
                    const valorFormatado = formatCurrency(transacao.valor);
                    const dataFormatada = transacao.data.toDate().toLocaleDateString('pt-BR');
                    
                    if (transacao.tipo === 'entrada') {
                        totalEntradas += transacao.valor;
                    } else {
                        totalSaidas += transacao.valor;
                    }

                    // HTML para a lista de transações
                    transactionsHtml += `
                        <div class="flex items-center justify-between py-2 border-b border-gray-100">
                            <div>
                                <h4 class="font-medium">${transacao.descricao}</h4>
                                <p class="text-sm text-muted">${dataFormatada}</p>
                            </div>
                            <span class="font-semibold ${transacao.tipo === 'entrada' ? 'text-green-600' : 'text-red-600'}">
                                ${transacao.tipo === 'entrada' ? '+' : '-'} ${valorFormatado}
                            </span>
                        </div>
                    `;

                    // HTML para as atividades recentes na página inicial (limite de 5)
                    if (count < 5) {
                         recentActivitiesHtml += `
                            <div class="flex items-center gap-4 py-2 px-4 border-b border-gray-100 last:border-b-0">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center ${transacao.tipo === 'entrada' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}">
                                    <i class="fas fa-${transacao.tipo === 'entrada' ? 'arrow-up' : 'arrow-down'}"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium">${transacao.descricao}</h4>
                                    <p class="text-xs text-muted">
                                        ${transacao.tipo === 'entrada' ? 'Entrada' : 'Saída'} em ${dataFormatada}
                                    </p>
                                </div>
                                <span class="font-bold ml-auto ${transacao.tipo === 'entrada' ? 'text-green-600' : 'text-red-600'}">
                                    ${transacao.tipo === 'entrada' ? '+' : '-'} ${valorFormatado}
                                </span>
                            </div>
                        `;
                    }
                    count++;
                });

                const saldoAtual = totalEntradas - totalSaidas;

                // Atualizar os elementos do dashboard
                totalEntradasEl.textContent = formatCurrency(totalEntradas);
                totalSaidasEl.textContent = formatCurrency(totalSaidas);
                saldoAtualEl.textContent = formatCurrency(saldoAtual);
                homeSaldoAtualEl.textContent = formatCurrency(saldoAtual);

                transactionsList.innerHTML = transactionsHtml;
                recentActivitiesList.innerHTML = recentActivitiesHtml;

            } catch (error) {
                console.error("Erro ao carregar transações:", error);
            }
        }
        
        // Função para salvar uma nova transação
        async function saveTransaction(event) {
            event.preventDefault();
            
            const form = event.target;
            const tipo = form.transactionType.value;
            const descricao = form.transactionDescription.value;
            const valor = parseFloat(form.transactionAmount.value);
            const data = form.transactionDate.value ? new Date(form.transactionDate.value) : new Date();

            if (isNaN(valor) || valor <= 0) {
                alert("Por favor, insira um valor válido.");
                return;
            }

            const transacao = {
                tipo,
                descricao,
                valor,
                data: firebase.firestore.Timestamp.fromDate(data)
            };

            try {
                await db.collection("transacoes").add(transacao);
                alert("Transação registrada com sucesso!");
                form.reset();
                loadTransactions(); // Recarregar os dados para atualizar o dashboard
            } catch (e) {
                console.error("Erro ao adicionar documento: ", e);
                alert("Ocorreu um erro ao registrar a transação.");
            }
        }

        // Adicionar o event listener ao formulário
        transactionForm.addEventListener('submit', saveTransaction);
        
        // Chamar a função para carregar as transações quando a página for carregada
        document.addEventListener('DOMContentLoaded', loadTransactions);

        // Sidebar e navegação
        const sidebar = document.getElementById('sidebar');
        const sidebarToggle = document.getElementById('sidebarToggle');
        const mobileSidebarToggle = document.getElementById('mobileSidebarToggle');
        const navLinks = document.querySelectorAll('.sidebar-menu-link');
        const sections = document.querySelectorAll('.content-section');
        const homeLink = document.getElementById('homeLink');

        function toggleSidebar() {
            sidebar.classList.toggle('collapsed');
        }

        function showSection(sectionId) {
            sections.forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(sectionId).classList.add('active');
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.dataset.section === sectionId) {
                    link.classList.add('active');
                }
            });
        }

        sidebarToggle.addEventListener('click', toggleSidebar);
        mobileSidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('open');
        });
        homeLink.addEventListener('click', (e) => {
            e.preventDefault();
            showSection('home');
        });
        navLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const sectionId = e.target.closest('a').dataset.section;
                showSection(sectionId);
                // Fechar sidebar em mobile após clique
                if (window.innerWidth <= 768) {
                    sidebar.classList.remove('open');
                }
            });
        });

        // Preencher o seletor de anos
        const currentYear = new Date().getFullYear();
        const yearSelect = document.getElementById('transactionYear');
        for (let i = currentYear; i >= 2020; i--) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            yearSelect.appendChild(option);
        }
        yearSelect.value = currentYear;
        
    </script>
</body>
</html>
